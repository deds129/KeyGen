<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="java">

<head th:replace="_layout :: html_head">
	<title>License keys</title>
</head>

<body>


<div th:insert="_layout :: html_navbar"></div>

<div class="container mb-4">


	<div>
		<h3>Licenses</h3>
	</div>
	<br>
	<div>
		<form class="form-inline" method="get">
			<input class="form-control mr-sm-2" type="search" name="searchStr" placeholder="Search" aria-label="Search">
			<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Customer</button>
		</form>
	</div>
	<br>
	<div>
		<table class="table table-striped container-fluid">
			<thead class="thead-light">
			<tr>
				<th scope="col">ID</th>
				<th scope="col">AUTHOR</th>
				<th scope="col">CUSTOMER</th>
				<th scope="col">LICENSE TYPE</th>
				<th scope="col">HOST</th>
				<th scope="col">PORT</th>
				<!--th scope="col">START DATE</th-->
				<!--th scope="col">END DATE</th-->
				<th scope="col">FEATURES</th>
				<!--th scope="col">DB TYPES</th-->
				<th scope="col">OS</th>
				<!--todo reformat -->
				<th></th>
				<th colspan="3">OPTIONS</th>
			</tr>
			</thead>

			<tr th:each="license, state : ${allLicenses}">
				<td th:utext="${license.id}">ID</td>
				<!--one to many -->
				<!--todo add links to user/author pages -->
				<td th:utext="${license.author.username}">AUTHOR</td>
				<td th:utext="${license.customer.custName}">CUSTOMER</td>
				<td th:utext="${license.licenseType.typeTitle}">LICENSE TYPE</td>
				<!--simple fields -->
				<td th:utext="${license.host}">HOST</td>
				<td th:utext="${license.port}">PORT</td>

				<!--many to many fields, lists-->
				<!--td th:utext="${license.startDate}">Start date</td-->
				<!--td th:utext="${license.endDate}">End date</td-->
				<td th:utext="${license.getFeaturesTitles()}">Features</td>
				<!--td th:utext="${license.dbTypes}">Db types</td-->
				<td th:utext="${license.getOsTitles()}">OS</td>
				<td>
					<!-- Button trigger modal -->
					<button type="button" class="btn btn-warning btn-sm" data-toggle="modal"
							th:data-target="'#modalButton' + ${license.id}">
						Show License
					</button>

					<!-- Modal -->
					<div class="modal fade" th:id="'modalButton' + ${license.id}" tabindex="-1" role="dialog"
						 aria-hidden="true">
						<div class="modal-dialog modal-dialog-centered" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title">License Key</h5>
									<button type="button" class="close" data-dismiss="modal" aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="modal-body">
									<p style="word-break: break-all" th:utext="${license.key}">Key</p>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
									<button type="button" class="btn btn-primary">Copy to clipboard</button>
								</div>
							</div>
						</div>
					</div>
				</td>
				<td>
					<div>
						<form name="license" th:action="@{/deleteLicense}" method="post">
							<input class="btn btn-danger btn-sm" type="submit" value="Delete"/>
							<input type="hidden" name="licId"
								   th:value="${license.id}"/>
						</form>
					</div>
				</td>
				<td>
					<div>
						<form name="license" th:action="@{/updateLicense}" method="post">
							<input class="btn btn-primary btn-sm" type="submit" value="Update"/>
							<input type="hidden" name="licId" th:value="${license.id}"/>
						</form>
					</div>
				</td>
			</tr>
		</table>
	</div>

	<div>
		<button type="button" class="btn btn-outline-danger" onclick="window.location.href = 'addLicense'">Add new
			License
			Key
		</button>
	</div>

</div>

</body>
</html>